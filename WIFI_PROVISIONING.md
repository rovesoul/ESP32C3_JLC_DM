# WiFi配网功能使用说明

## 功能说明
设备首次烧录后必须通过Web界面配置WiFi才能使用。
支持按键触发重新配网（长按Boot按键5秒）。

## 使用步骤

### 1. 烧录固件
```bash
idf.py build
idf.py -p /dev/ttyUSB0 erase-flash flash monitor
```

### 2. 配网模式
串口会显示：
```
未检测到WiFi配置，进入配网模式...
1. 连接WiFi: ESP32-Setup_A1B2C3
2. 密码: 12345678
3. 打开浏览器访问: http://192.168.4.1
```

### 3. 手机配置
- 手机连接热点：`ESP32-Setup_A1B2C3`（密码：12345678）
- 浏览器访问：http://192.168.4.1
- 输入家庭WiFi名称和密码
- 点击"连接WiFi"，等待设备重启

### 4. 正常使用
设备重启后会自动连接配置的WiFi，串口显示IP地址。

## 重新配网方法

### 方法1：按键触发（推荐）
**操作步骤：**
1. 设备正常运行时，找到开发板上的 **Boot按键**
2. **长按Boot按键5秒**，不要松开
3. 串口会显示：
   ```
   检测到按键按下... 1/5秒
   检测到按键按下... 2/5秒
   ...
   检测到按键长按5秒！
   正在清除WiFi配置...
   ✅ WiFi配置已清除
   设备即将重启进入配网模式...
   ```
4. 设备自动重启，进入配网模式
5. 重新配置WiFi

**优点：**
- 无需擦除Flash
- 保留PID、风扇等其他配置
- 操作简单快捷

### 方法2：擦除Flash
如果需要完全清除所有配置：
```bash
idf.py -p /dev/ttyUSB0 erase-flash flash
```

## 工作原理

### 按键检测
- 设备启动后会自动创建按键检测任务
- 每100ms检测一次Boot按键（GPIO 0）状态
- 检测到长按5秒后自动清除WiFi配置并重启
- 串口会实时显示按键按下时间

### 路由器关闭后的行为
- 如果路由器关闭，设备会自动重连（不断重试）
- **长按Boot按键5秒**可清除WiFi配置
- 设备重启后进入配网模式，可配置新的WiFi

## 注意事项
- ESP32-C3仅支持2.4GHz WiFi
- 配网超时时间：5分钟
- WiFi凭据保存在NVS，断电不丢失
- 长按按键会清除WiFi配置，但保留PID/风扇等其他配置
- 按键检测任务优先级最低，不影响主程序运行
